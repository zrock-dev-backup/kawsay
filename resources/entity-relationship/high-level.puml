@startuml
title Kawsay Timetable System - Logical Data Model (v3 - Based on Workflow Document)

skinparam linetype ortho

' --- Core Academic & Structural Entities ---

entity Course {
  + **CourseCode** [PK]
  --
  * Name: varchar
  * DurationWeeks: int
}
note top: Represents a catalog course, e.g., "CS101".

entity Teacher {
  + **TeacherID** [PK]
  --
  * FullName: varchar
}

entity Timetable {
  + **TimetableID** [PK]
  --
  * Name: varchar
  * Module: varchar
  * Track: enum
  * StartDate: date
  * EndDate: date
}

' --- The Formal Academic Hierarchy ---

entity Cohort {
  + **CohortID** [PK]
  --
  * Name: varchar
}
note right: The highest-level student grouping, e.g., "Fall 2024".

entity "Group" as Group {
  + **GroupID** [PK]
  --
  * Name: varchar
}
note right: A subdivision of a Cohort, attends a Master Class together.

entity Section {
  + **SectionID** [PK]
  --
  * Name: varchar
}
note right: A subdivision of a Group, often for labs/tutorials.

' --- Student Entity with Eligibility Model ---

entity Student {
  + **StudentID** [PK]
  --
  * FullName: varchar
  * Email: varchar
  * Status: enum ('Enrolled', 'Withdrawn', 'Freeze/LOA')
  * EligibilityStatus: enum ('Yes', 'No', 'Maybe')
  --
  # SectionID [FK]
}
note bottom of Student: A student has a "home" Section for administrative grouping.

entity EligibilityLog {
  + **LogID** [PK]
  --
  * AssessedStatus: enum
  * Justification: text (e.g., "GPA: 2.8, SPA: OK, SS Notes: ...")
  * AssessedBy: varchar
  * Timestamp: datetime
  --
  # StudentID [FK]
  # CourseCode [FK]
}
note "Tracks the 'likelihood analysis' for students with 'Maybe' eligibility for a specific course." as N_Eligible

' --- Class and Enrollment Entities ---

entity Class {
  + **ClassID** [PK]
  --
  * ClassType: enum ('Masterclass', 'Lab')
  * DayOfWeek: enum
  * StartTime: time
  * EndTime: time
  --
  # CourseCode [FK]
  # TeacherID [FK]
  # TimetableID [FK]
  # GroupID [FK, nullable]
  # SectionID [FK, nullable]
}
note top of Class
A scheduled instance of a Course.
A Masterclass links to a Group.
A Lab/Section links to a Section.
end note

entity Enrollment {
  + **StudentID** [FK]
  + **ClassID** [FK]
  --
  * Status: enum ('Confirmed', 'Withdrawn', 'Dropped_Attendance')
}

' --- Relationships ---

' Hierarchy Relationships
Cohort "1" -- "1..*" Group : "contains"
Group "1" -- "1..*" Section : "contains"
Section "1" -- "0..*" Student : "has as home section"

' Scheduling Relationships
Timetable "1" -- "0..*" Class : "schedules"
Course "1" -- "0..*" Class : "is instance of"
Teacher "1" -- "0..*" Class : "teaches"

' Class to Hierarchy Links
Group "1" -- "0..*" Class : "(Masterclass) is for"
Section "1" -- "0..*" Class : "(Lab) is for"

' Student Enrollment (decoupled from hierarchy)
Student "1" -- "0..*" Enrollment : "has"
Class "1" -- "0..*" Enrollment : "has"

' Eligibility Logging
Student "1" -- "0..*" EligibilityLog : "has log for"
Course "1" -- "0..*" EligibilityLog
EligibilityLog .. N_Eligible

' --- Self-Referencing Prerequisite Relationship ---
entity CoursePrerequisite {
  + **CourseCode** [FK]
  + **PrerequisiteCourseCode** [FK]
}
Course "1" -- "0..*" CoursePrerequisite : "requires >"
Course "1" -- "0..*" CoursePrerequisite : "< is prerequisite for"

@enduml
